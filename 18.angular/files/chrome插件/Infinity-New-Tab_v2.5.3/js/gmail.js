var Gmail__link="https://mail.google.com/mail/ca";$(document).ready(function(){if(!localStorage.GmailNum){localStorage.GmailNum=0}if(!localStorage.gmailLogin){localStorage.gmailLogin="false"}try{setTimeout(function(){$gmail()},500)}catch(a){console.log(a)}});function checkForValidUrl(b,a,c){if(JSON.parse(localStorage.setting).showPageAction){if(c.url.indexOf("chrome://newtab")==0){}else{chrome.pageAction.show(c.id)}}else{}}try{chrome.tabs.onUpdated.addListener(checkForValidUrl)}catch(e){}chrome.notifications.onClicked.addListener(function(a){if(a.indexOf("gmail")>=0){window.open(Gmail__link,"_blank")}return false});function xmlToJson(c){var h={};if(c.nodeType==1){if(c.attributes.length>0){h["@attributes"]={};for(var b=0;b<c.attributes.length;b++){var g=c.attributes.item(b);h["@attributes"][g.nodeName]=g.value}}}else{if(c.nodeType==3){h=c.nodeValue}}if(c.hasChildNodes()){for(var d=0;d<c.childNodes.length;d++){var f=c.childNodes.item(d);var k=f.nodeName;if(typeof(h[k])=="undefined"){h[k]=xmlToJson(f)}else{if(typeof(h[k].length)=="undefined"){var a=h[k];h[k]=[];h[k].push(a)}h[k].push(xmlToJson(f))}}}return h}function $gmail(){try{var a=JSON.parse(localStorage.setting);var b=localStorage.gmailLogin;if(b=="true"){if(a.GmailMessage){$.ajax({url:"https://mail.google.com/mail/u/0/feed/atom/?timestamp="+new Date().getTime(),dataType:"xml"}).done(function(j,d,p){try{if(p.status==401){return false}var i=xmlToJson(j);var h=i.feed.fullcount["#text"];try{try{var o=i.feed.entry[0].title["#text"]}catch(k){var o=i18n("noTitle")}try{var q=i.feed.entry[0].summary["#text"]}catch(k){var q=""}try{var f=i.feed.entry[0].author.name["#text"]}catch(k){var f=""}try{var m=i.feed.entry[0].author.email["#text"]}catch(k){var m=""}Gmail__link=i.feed.entry[0].link["@attributes"].href}catch(k){try{var o=i.feed.entry.title["#text"]}catch(k){var o=i18n("noTitle")}try{var q=i.feed.entry.summary["#text"]}catch(k){var q=""}try{var f=i.feed.entry.author.name["#text"]}catch(k){var f=""}try{var m=i.feed.entry.author.email["#text"]}catch(k){var m=""}Gmail__link=i.feed.entry.link["@attributes"].href}var g={type:"basic",title:f+":"+o,message:q.substr(0,38)+"...",iconUrl:"img/mail.png"};h=parseInt(h);var l=parseInt(localStorage.GmailNum);if(h>l){chrome.notifications.create("gmail"+new Date().getTime(),g,function(n){if(a.notificationSound){$("#audio")[0].play()}})}localStorage.GmailNum=h;setTimeout(function(){$gmail()},1000*2)}catch(k){}}).fail(function(){})}}else{setTimeout(function(){$gmail()},1000*3)}}catch(c){console.log(c)}};