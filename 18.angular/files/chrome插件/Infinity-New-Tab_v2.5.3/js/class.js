"use strict";var GetOriginalImage=null;var ImageWidth=screen.width;var BlurRadius=18;var AllICONNUM=0;var APPID="dbfmnekepjoapopniengjbcpnbljalfg";var Gmail_Ajax=null;var Gmail__link="";var __Weather_focus=false;window.$my={body:$("body"),bgOut:$("#bgOut"),all:$("#all"),addButton:$(".addButton"),G_SlideOut:true,G_SlideLock:false,slide:{apps:false,setting:false,weather:false,history:false,notepad:false,todos:false,bookmarks:false,edit:false}};window.$loadHtml=function(a,b){try{$.ajax({url:b+"?time="+new Date().getTime(),async:false}).done(function(data){$(a).html(data)})}catch(e){}};$.loadHtml=function(a,b,c){try{$.ajax({url:b}).done(function(data){$(a).html(data);$setlang.ini(a);try{if(c){c()}}catch(e){}})}catch(e){}};window.i18n=function(msgname){try{return chrome.i18n.getMessage(msgname)}catch(err){return msgname}};window.isZh=function(){if(i18n("lang")=="zh"){return true}else{return false}};window.$setlang={ini:function(cs){var div="";if(!typeof(cs)=="undefined"){div=cs+" "}var n=$(div+"[i18n]").length;for(var i=0;i<n;i++){var obj=$("[i18n]")[i];var a=obj.getAttribute("i18n");var b=i18n(a);$(obj).text(b)}var z=$(div+"[i18nh]").length;for(var i=0;i<z;i++){var obj=$("[i18nh]")[i];var a=obj.getAttribute("i18nh");var b=i18n(a);$(obj).html(b)}var m=$(div+"[i18n-placeholder]").length;for(var i=0;i<m;i++){var obj=$("[i18n-placeholder]")[i];var a=obj.getAttribute("i18n-placeholder");var b=i18n(a);$(obj).attr("placeholder",b)}var q=$(div+"[i18n-value]").length;for(var i=0;i<q;i++){var obj=$("[i18n-value]")[i];var a=obj.getAttribute("i18n-value");var b=i18n(a);$(obj).attr("value",b)}var p=$(div+"[i18n-title]").length;for(var i=0;i<p;i++){var obj=$("[i18n-title]")[i];var a=obj.getAttribute("i18n-title");var b=i18n(a);$(obj).attr("title",b)}}};window.$setData={ini:function(){try{var n=$("[infinity-Data-Check]").length;for(var i=0;i<n;i++){var obj=$("[infinity-Data-Check]")[i];var a=obj.getAttribute("infinity-Data-Check");var b=$setting.get(a);if(b){$(obj).attr("checked","true")}else{$(obj).removeAttr("checked")}}var m=$("[infinity-Data-Text]").length;for(var i=0;i<m;i++){var obj=$("[infinity-Data-Text]")[i];var a=obj.getAttribute("infinity-Data-Text");var b=$setting.get(a);$(obj).text(b)}var q=$("[infinity-Data-Value]").length;for(var i=0;i<q;i++){var obj=$("[infinity-Data-Value]")[i];var a=obj.getAttribute("infinity-Data-Value");var b=$setting.get(a);$(obj).val(b)}var p=$("[infinity-Data-Checks]").length;for(var i=0;i<p;i++){var obj=$("[infinity-Data-Checks]")[i];var a=obj.getAttribute("infinity-Data-Checks");var c=a.split("|");var b=$setting.get(c[0]);if(b==c[1]){$(obj).attr("checked",true)}}}catch(e){console.log(e)}}};window.$notification={show:function(text,isColor){var n=$("#notification");n.css("background-color","");if(typeof(isColor)=="undefined"){n.text(text).fadeIn(300,function(){setTimeout(function(){n.fadeOut(300,function(){})},2000)})}else{n.css("background-color","#2ECC71").text(text).fadeIn(300,function(){setTimeout(function(){n.fadeOut(300,function(){})},2000)})}}};window.$setting={add:function(a,b){var setting=localStorage.setting;var obj={};var s;try{if(setting){obj=JSON.parse(setting);if(typeof(obj[a])!="undefined"){if(typeof(obj[a])=="boolean"){}else{if(typeof(obj[a])=="string"){}}}else{obj[a]=b;s=JSON.stringify(obj);localStorage.setting=s}}else{obj={};obj[a]=b;s=JSON.stringify(obj);localStorage.setting=s}}catch(e){console.log(e)}},get:function(a){var setting=localStorage.setting;var obj={};try{obj=JSON.parse(setting);return obj[a]}catch(e){}},set:function(a,b){var setting=localStorage.setting;var obj={};try{obj=JSON.parse(setting);obj[a]=b;localStorage.setting=JSON.stringify(obj);if(a!="mostVisits"&&a!="wpTime"&&a!="cloudBackup"&&a!="wcity"&&a!="wcountry"&&a!="lastWallpaper"&&a!="bgType"&&a!="bgname"){$setting.sync()}}catch(e){}},onChange:function(){$("input[type=radio]").live("change",function(event){var name=$(this).attr("name");var value=$(this).val();$setting.set(name,value)});$("input.checkBoxToggle").live("change",function(event){var name=$(this).attr("name");var value=$(this).is(":checked");$setting.set(name,value)})},onRangeChange:function(){$("input[type=range]").live("input",function(event){event.preventDefault();var name=$(this).attr("name");var value=$(this).val();var ra;$("#"+name+"Value").text(value);if($(this)[0].id=="iconRadius"){ra=Math.round(value/2)+"%";$(".iconInIn,.icon,.editico,.webIconImg,#iconPreviewTop,#EditiconPreviewTop").css("border-radius",ra)}else{if($(this)[0].id=="iconOpacity"){$(".icon").css("opacity",value/100)}}});$("input[type=range]").live("change",function(event){event.preventDefault();var name=$(this).attr("name");var value=$(this).val();$setting.set(name,value)})},sync:function(a){if(Show_Noti_Num){setAllNotiNum()}var isBackup=$setting.get("cloudBackup");if(isBackup){syncToCloud()}console.log("设置数据已同步")}};window.$Slide=function(id,name,bc,pt){try{this.name=name;var l=name.length;var topMenu="";var box="";var bgColor=bc;var paddingTop=pt;for(var i=0;i<l;i++){topMenu+='<div class="topMenu" in="'+id+'Slide" with="'+id+i+'" style="'+(i==0&&l!=1?"border-bottom:solid 2px #fdfdfd;":"")+'">'+name[i]+"</div>";
box+='<div class="SlideBox" id="'+id+i+'SlideBox"></div>'}this.slide='<div id="'+id+'Slide" class="Slide" style="padding-top:'+(paddingTop?paddingTop:"75")+'px;visibility:hidden;"><div class="slideTitle"  style="background-color:'+(bgColor?bgColor:"")+';">'+topMenu+'</div><div id="'+id+'SlideBigBox" class="SlideBigBox">'+box+"</div></div>";$("[type="+id+"]").live("click",function(event){if(!G_Infinity_Open_Lock||id=="edit"){$("#"+id+"Slide").css("visibility","visible");if(!$my.slide[id]){$my.addButton.addClass("addButtonToClose");SlideInElse("id");$("#"+id+"Slide").addClass("slideOut");$("#bgOut").addClass("bgMoveOut");$("#bgImg").addClass("bgMoveOut");$my.slide[id]=true}else{$my.addButton.removeClass("addButtonToClose");$("#"+id+"Slide").removeClass("slideOut");$("#bgOut").removeClass("bgMoveOut");$("#bgImg").removeClass("bgMoveOut");$my.slide[id]=false}}return false});$("#"+id+"Slide").live("webkitTransitionEnd",function(event){if(!$my.slide[id]){$("#"+id+"Slide").css("visibility","hidden")}else{if(id=="todos"){$("#addTodos")[0].focus()}if(id=="setting"){$("#addSearch")[0].focus()}if(id=="notepad"){$("#addNotesTitle")[0].focus()}if(id=="bookmarks"){$("#searchBookmarks")[0].focus()}if(id=="history"){$("#searchhistory")[0].focus()}if(__Weather_focus){$("#weatherinput")[0].focus();__Weather_focus=false}}});$my.bgOut.click(function(e){if($my.slide[id]){var isIn=false;var obj=$(e.target);if(obj.parents("#"+id+"Slide").length>0){}else{if(obj.parents("#bgOut").length>0){if(obj.parents("#mainOut").length>0){if(obj.parents(".groupIn").length>0){}else{isIn=true}}else{isIn=true}}else{isIn=true}}if(obj.parents("#searchOut").length>0){isIn=false}if(obj.parents("#pointOut").length>0){isIn=false}if(obj[0].id=="searchOption"){isIn=true}if(isIn){$("#"+id+"Slide").removeClass("slideOut");$("#bgOut").removeClass("bgMoveOut");$("#bgImg").removeClass("bgMoveOut");$my.slide[id]=false;$my.addButton.removeClass("addButtonToClose");slideUnLock();addSettingStart()}}});this.add=function(i,x){if(i=="menu"){$("#"+id+"SlideBigBox").before(x)}else{$("#"+id+i+"SlideBox").append(x)}};this.append=function(){$my.all.append(this.slide)}}catch(e){}};window.SlideInElse=function(a){var obj;for(obj in $my.slide){if(obj!=a&&$my.slide[obj]==true){$("#"+obj+"Slide").removeClass("slideOut");$("#bgOut").removeClass("bgMoveOut");$("#bgImg").removeClass("bgMoveOut");$my.slide[obj]=false}}};window.isAllSlideFalse=function(){var obj;var b=true;for(obj in $my.slide){if($my.slide[obj]!=false){b=false}}return b};window.$addButton={ini:function(){$my.addButton.click(function(event){if(isAllSlideFalse()){$("#settingSlide").css("visibility","visible");$addButton.rotatedToClose();SlideInElse("setting");$("#settingSlide").addClass("slideOut");$("#bgOut").addClass("bgMoveOut");$("#bgImg").addClass("bgMoveOut");$my.slide.setting=true;$(".topMenu").css("border-bottom","");$("[in=settingSlide]:nth-child(1)").css("border-bottom","solid 2px #fdfdfd");$("#setting0SlideBox,#setting0SlideMenu").show();$("#setting1SlideBox,#setting1SlideMenu").hide();try{$infinityIcon.loadPopularIcon();$infinityIcon.addInfinityIcons();onAddbuttonOpen()}catch(e){}}else{$addButton.rotatedToOpen();SlideInElse();slideUnLock();$("#editBoxHover").hide()}})},rotatedToClose:function(){$my.addButton.addClass("addButtonToClose");$("#addRightTop").html("")},rotatedToOpen:function(){$my.addButton.removeClass("addButtonToClose")}};function addSettingStart(){setTimeout(function(){$(".ADD").css("color","");$(".ADD:nth-child(1)").css("color","#2ECC71");$(".addContain").hide();$("#addContain0").show();$(".ST").css("color","");$(".ST:nth-child(1)").css("color","#2ECC71");$(".settingBox").hide();$("#settingBoxGeneralST").show();$("#addSearch,#addUrl,#addTitle").val("");$("#iconPreview").css("background-image","");$("#iconPreview").attr("bgImg","");$("#iconPreview").attr({"top":"0","left":"0"});$("#uploadImage").val("");$("#remove,#imgSize,#imageSize,.adjustBu,#shareIcon").hide();$("#previewName").text("");$("#feedbackText").val("");$("#allFeedback").removeClass("loginBoxHide");$("#thankFeedback").hide();var canvas=document.getElementById("mycanvas");var ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);$("#iconPreview").attr("dragMove","false");$(".icobgColor").css("border-color","transparent");var color=$(".icobgColorPre:nth-child(1)").css("background-color");$(".icobgColorPre:nth-child(1)").css("border-color",color);$("#iconPreviewTop").css({"background-color":color,"background-image":""})},300)}window.$topMenu={ini:function(){$(".topMenu").live("click",function(){var pn=$(this).parent().children().length;var Slideid=$(this).attr("in");var pid="#"+Slideid;if(pn>=2){var theid=$(this).attr("with");$("."+Slideid+"Menu").hide();$("#"+theid+"SlideMenu").show();$(pid+" .topMenu").css("border-bottom","");$(this).css("border-bottom","solid 2px #fdfdfd");$(pid+" .SlideBox").hide();$("#"+theid+"SlideBox").show()}return false})}};window.checkeURL=function(str){var Expression=/http(s)?:/;var objExp=new RegExp(Expression);
if(str.indexOf("localhost")){str=str.replace("localhost","127.0.0.1")}if(objExp.test(str)==true){return true}else{return false}};window.$firstSlide={weather:true,setting:true,todos:true,bookmarks:true,notepad:true,history:true,apps:true,edit:true};window.$my.$settingContent={ini:function(){var $settingSlide=new $Slide("setting",[i18n("addCustomItem"),i18n("settings")],"#2ECC71",125);$settingSlide.append();$.loadHtml("#setting0SlideBox","app/add/add.html");$.loadHtml("#setting1SlideBox","app/setting/setting.html",function(){try{var user=JSON.parse(localStorage.user);if(user.isLogin){whenLogin(user)}else{whenUnlogin(user)}}catch(e){}});$("[type=setting]").live("click",function(e){$(".topMenu").css("border-bottom","");$("[with=setting1]").css("border-bottom","solid 2px #fdfdfd");$("#setting0SlideBox").hide();$("#setting1SlideBox").show();$("#setting1SlideMenu").show()})}};window.$my.$todos={ini:function(){var $todoSlide=new $Slide("todos",[i18n("Todos")],"#2ECC71");$todoSlide.append();$.loadHtml("#todosSlideBigBox","app/todos/todos.html")}};window.$my.$weather={ini:function(){var $weatherSlide=new $Slide("weather",[i18n("Weather")],"transparent");$weatherSlide.append();$.loadHtml("#weatherSlideBigBox","app/weather/weather.html")}};window.$my.$bookmarks={ini:function(){var $bookmarksSlide=new $Slide("bookmarks",[i18n("Bookmarks")],"#3498DB");$bookmarksSlide.append();$.loadHtml("#bookmarksSlideBigBox","app/bookmarks/bookmarks.html")}};window.$my.$notes={ini:function(){var $notesSlide=new $Slide("notepad",[i18n("NotesAndIdeas")],"#F1C40F");$notesSlide.append();$.loadHtml("#notepadSlideBigBox","app/notes/notes.html")}};window.$my.$history={ini:function(){var $historySlide=new $Slide("history",[i18n("History")],"#9B59B6");$historySlide.append();$.loadHtml("#historySlideBigBox","app/history/history.html")}};window.$my.$apps={ini:function(){var $appSlide=new $Slide("apps",[i18n("AppsAndExtensions")],"#1abc9c");$appSlide.append();$.loadHtml("#appsSlideBigBox","app/apps/apps.html")}};window.clearBr=function(key){key=key.replace(/<\/?.+?>/g,"");key=key.replace(/[\r\n]/g,"");return key};window.geticonBase64=function(icon,callback){try{$.ajax({url:icon+".json",async:false}).done(function(data){var ico;var img=new Image();img.src=data;var canvas=document.getElementById("iconCanvas");var ctx=canvas.getContext("2d");canvas.width=150;canvas.height=150;ctx.clearRect(0,0,150,150);ctx.drawImage(img,0,0,150,150);ico=canvas.toDataURL();callback(ico)})}catch(e){}};window.geticonSmall=function(icon,callback){try{var ico;var img=new Image();img.src=icon;var canvas=document.getElementById("iconCanvas");var ctx=canvas.getContext("2d");canvas.width=150;canvas.height=150;ctx.clearRect(0,0,150,150);ctx.drawImage(img,0,0,150,150);ico=canvas.toDataURL();callback(ico)}catch(e){}};window.$dataRestore={ini:function(){$dataRestore.Restore()},Restore:function(){try{$("#dataRestore").live("click",function(event){$(this).val("")});$("#dataRestore")[0].onchange=function(){var txt=this.files[0];var reader=new FileReader();reader.readAsText(txt);reader.type="text";reader.onload=function(){var json=reader.result;var jsonHeader=json.substring(0,30);if(jsonHeader.indexOf("infinity")>=0){$dataRestore.infinityOldRestore(json);return false}if(jsonHeader.indexOf("theNew__INFINITY")>=0){$dataRestore.infinityNewRestore(json);return false}if(jsonHeader.indexOf("mifish_ext")>=0){$dataRestore.mifishRestore(json);return false}if(jsonHeader.indexOf("colorful")>=0){$dataRestore.mifishRestore(json);return false}}}}catch(e){}},infinityOldRestore:function(json){try{var data=JSON.parse(json)}catch(e){try{json=clearBr(json);var data=JSON.parse(json)}catch(e){$("#waiting").fadeOut(200);var text=i18n("RecoveryDataFailed");$notification.show(text);return false}}try{var main=data.main;var setting=JSON.stringify(data.setting);TransformOld(main,function(main){localStorage.setting=setting;var themain=JSON.stringify(main);localStorage.main=themain;recoveryTheData(setting,themain);$setting.set("showPageAction",true);$("[name=showPageAction]").attr("checked","true");$notification.show(i18n("RecoveryDataSuccess"),true);$setting.sync()})}catch(e){var text=i18n("RecoveryDataFailed");$notification.show(text);return false}},infinityNewRestore:function(json){try{var obj=JSON.parse(json);var setting=decodeURIComponent(obj.setting);var main=decodeURIComponent(obj.main);localStorage.setting=setting;localStorage.main=main;recoveryTheData(setting,main);$notification.show(i18n("RecoveryDataSuccess"),true);$setting.sync()}catch(e){var text=i18n("RecoveryDataFailed");$notification.show(text);return false}},mifishRestore:function(json){try{var data=JSON.parse(json)}catch(e){try{json=clearBr(json);var data=JSON.parse(json)}catch(e){$("#waiting").fadeOut(200);var text=i18n("RecoveryDataFailed");$notification.show(text);return false}}try{var main=getbackupIcons(data);recoveryTheDataMain(main);$notification.show(i18n("RecoveryDataSuccess"),true);$setting.sync()}catch(e){console.log(e);var text=i18n("RecoveryDataFailed");
$notification.show(text);return false}},VplusRestore:function(json){console.log("colorful")}};function getbackupIcons(data){var icons=[];var site=JSON.parse(data.sites);for(var x in site){for(var y in site[x].icons){if(site[x].icons[y].type!="2"){try{var url=new URL(site[x].icons[y].ico).hostname.toLowerCase()}catch(e){try{var url=new URL(site[x].icons[y].url).hostname.toLowerCase()}catch(e){var url=""}}if(url.indexOf("www.")>=0){url=url.substr(4,url.length-4)}site[x].icons[y].domain=url.toLowerCase();icons.push(site[x].icons[y])}else{try{var url="app://"+site[x].icons[y].appid;site[x].icons[y].url=url;site[x].icons[y].domain="app";icons.push(site[x].icons[y])}catch(e){}}}}var icos=[];var color=["#1ABC9C","#2ECC71","#33C5C5","#3498DB","#9B59B6","#34495E","#F1C40F","#E67E22","#E74C3C","#95A5A6"];for(var z in icons){var item={};var ico="";if(icons[z].domain==""){}else{if(icons[z].domain=="app"){if(icons[z].img){ico=icons[z].img}else{ico=icons[z].ico}}else{getIcon(icons[z].domain,function(c){ico=c})}}icons[z].ico=ico;item.name=icons[z].name;item.ico=icons[z].ico;if(icons[z].domain.indexOf("tmall")>=0){item.url="http://tmall.com"}else{if(icons[z].url.indexOf("yiqifa.com")>=0){item.url="http://infinitynewtab.com/jd.com.html"}else{if(icons[z].url.indexOf("tag=chromenewtab-20")>=0){item.url="http://amazon.com"}else{if(icons[z].url.indexOf("jd.com")>=0){item.url="http://infinitynewtab.com/jd.com.html"}else{if(icons[z].url.indexOf("ebay.com")>=0){item.url="http://www.ebay.com/"}else{item.url=icons[z].url}}}}}if(item.ico==""){item.type="custom";item.title=icons[z].name.substr(0,3);item.bgColor=color[Math.floor(Math.random()*color.length)]}else{if(item.ico.substring(0,10).indexOf("chrome://")>=0){item.type="app";item.bgColor="#fdfdfd"}else{item.type="ico"}}icos.push(item)}icos.unshift({"type":"weather","ico":"http://infinityicon.infinitynewtab.com/icon/150127092540.png","bgColor":"#7adaff","name":i18n("Weather"),"url":"","notiNum":0},{"type":"todos","ico":"http://infinityicon.infinitynewtab.com/icon/150127093122.png","bgColor":"transparent","name":i18n("Todos"),"url":"","notiNum":0},{"type":"apps","ico":"http://infinityicon.infinitynewtab.com/icon/150127092038.png","bgColor":"transparent","name":i18n("Apps"),"url":"","notiNum":0},{"type":"notepad","ico":"http://infinityicon.infinitynewtab.com/icon/150127092837.png","bgColor":"transparent","name":i18n("NotesAndIdeas"),"url":"","title":"","notiNum":0},{"type":"history","ico":"http://infinityicon.infinitynewtab.com/icon/150127092734.png","bgColor":"transparent","name":i18n("History"),"url":"","notiNum":0},{"type":"setting","ico":"http://infinityicon.infinitynewtab.com/icon/150127092940.png","bgColor":"transparent","name":i18n("settings"),"url":"","notiNum":0},{"type":"bookmarks","ico":"http://infinityicon.infinitynewtab.com/icon/150204031618.png","bgColor":"transparent","name":i18n("bookmarks"),"url":"","notiNum":0});var allIcos=[icos];var GroupIcons=arrayGroupByNum(allIcos,2*5);return GroupIcons}function getIcon(domain,callback){try{$.ajax({url:"js/icon.json",dataType:"json",async:false}).done(function(theIcons){for(var x in theIcons){if(theIcons[x].url==null){var ico=""}else{if(theIcons[x].url.toLowerCase().indexOf(domain)>=0){if(domain=="google.com"){var ico="http://infinityicon.infinitynewtab.com/icon/150127092630.png"}else{var ico=theIcons[x].src}callback(ico);return false}}}callback(ico)})}catch(e){console.log(e);return false}}function TransformOld(main,callback){try{$.ajax({url:"js/icon.json",dataType:"json",async:false}).done(function(data){for(var i=0;i<main.length;i++){for(var j=0;j<main[i].length;j++){if(main[i][j].type=="setting"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127092940.png"}else{if(main[i][j].type=="weather"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127031616.png"}else{if(main[i][j].type=="todos"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127093122.png"}else{if(main[i][j].type=="apps"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127092038.png"}else{if(main[i][j].type=="notepad"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127092837.png"}else{if(main[i][j].type=="history"){main[i][j].ico="http://infinityicon.infinitynewtab.com/icon/150127092734.png"}else{main[i][j].ico=getIconSrcByUrl(main[i][j].url,data,main[i][j].ico);if(main[i][j].ico.indexOf("ico/")>=0){main[i][j].ico=getIconSrcByImageName(main[i][j].ico,data)}}}}}}}if(main[i][j].url.indexOf("p.yiqifa.com")>=0){main[i][j].url="http://infinitynewtab.com/jd.com.html"}if(main[i][j].url.indexOf("tag=chromenewtab-20")>=0){main[i][j].url="http://amazon.com"}if(main[i][j].url.indexOf("ebay.com")>=0){main[i][j].url="http://www.ebay.com/"}}}callback(main)}).fail(function(){console.log("error")})}catch(e){console.log(e)}}function getIconSrcByUrl(a,b,c){for(var i=0;i<b.length;i++){if(b[i].url==a){return b[i].src}}return c}function getIconSrcByImageName(a,b){for(var i=0;i<b.length;i++){if(b[i].imgname==a){return b[i].src
}}return false}window.$iconIni={firstLoad:function(){try{var main,other;if(!localStorage.main){if(isZh()){other=[{"type":"ico","ico":"http://7xilfp.com5.z0.glb.clouddn.com/icon/cdf251f986998285a4fa4a5ff5b9d33c.png","bgColor":"transparent","name":"好货啦","url":"http://haohuola.com"},{"type":"ico","ico":"http://infinityicon.infinitynewtab.com/icon/150128102407.png","bgColor":"transparent","name":"京东商城","url":"http://infinitynewtab.com/jd.com.html"},{"type":"setting","ico":"http://infinityicon.infinitynewtab.com/icon/150127092940.png","bgColor":"transparent","name":i18n("settings"),"url":""}]}else{other=[{"type":"ico","ico":"http://infinityicon.infinitynewtab.com/icon/150127093703.png","bgColor":"transparent","name":"Amazon","url":"http://amazon.com"},{"type":"ico","ico":"http://infinityicon.infinitynewtab.com/icon/150127092140.png","bgColor":"transparent","name":"Facebook","url":"https://www.facebook.com/"},{"type":"setting","ico":"http://infinityicon.infinitynewtab.com/icon/150127092940.png","bgColor":"transparent","name":i18n("settings"),"url":""}]}main=[[{"type":"weather","ico":"http://infinityicon.infinitynewtab.com/icon/150127092540.png","bgColor":"#7adaff","name":i18n("Weather"),"url":""},{"type":"todos","ico":"http://infinityicon.infinitynewtab.com/icon/150127093122.png","bgColor":"transparent","name":i18n("Todos"),"url":""},{"type":"apps","ico":"http://infinityicon.infinitynewtab.com/icon/150127092038.png","bgColor":"transparent","name":i18n("Apps"),"url":""},{"type":"notepad","ico":"http://infinityicon.infinitynewtab.com/icon/150127092837.png","bgColor":"transparent","name":i18n("NotesAndIdeas"),"url":""},{"type":"bookmarks","ico":"http://infinityicon.infinitynewtab.com/icon/150204031618.png","bgColor":"transparent","name":i18n("Bookmarks"),"url":""},{"type":"history","ico":"http://infinityicon.infinitynewtab.com/icon/150127092734.png","bgColor":"transparent","name":i18n("History"),"url":""},{"type":"gmail","ico":"http://infinityicon.infinitynewtab.com/icon/150127092622.png","bgColor":"transparent","name":"Gmail","url":"https://mail.google.com/mail/u/0/"}],[{"type":"ico","ico":"http://infinityicon.infinitynewtab.com/icon/150127092207.png","bgColor":"transparent","name":i18n("ChromeStore"),"url":"https://chrome.google.com/webstore?utm_source=InfinityNewtab"}]];main[0]=main[0].concat(other);localStorage.main=JSON.stringify(main);$iconIni.load(main)}else{main=JSON.parse(localStorage.main);if(!localStorage.InfinityNew){localStorage.InfinityNew=1;TransformOld(main,function(main){localStorage.main=JSON.stringify(main);$iconIni.load(main)})}else{$iconIni.load(main)}}}catch(e){}},load:function(main,vv){var div="";var ml=main.length;var mainWidth=main.length*1212;var pointerOutWidth=main.length*40;$("#pointOut").css("width",pointerOutWidth);$("#mainAll").css("width",mainWidth);var iconOpacity=$setting.get("iconOpacity")/100;var borderRadius=Math.round($setting.get("iconFillet"))/2;var fontColor=$setting.get("fontColor");var iconNum=vv?vv:$setting.get("iconNum");AllICONNUM=0;for(var i=0;i<ml;i++){div+='<div class="group">';div+='<div class="groupIn" type="groupIn">';var mil=main[i].length;for(var j=0;j<mil;j++){div+='<div icon="icon" draggable="true" class="icon theIcon'+iconNum+'" type="'+main[i][j].type+'" url="'+main[i][j].url+'" ico="'+main[i][j].ico+'" iconname="'+main[i][j].name+'" bgColor="'+main[i][j].bgColor+'" style="opacity:'+iconOpacity+";border-radius:"+borderRadius+'%">';div+='<div icon="icon" draggable="false" class="iconIn" style="">';div+='<div icon="icon" draggable="false" class="iconInIn" style="z-index:-1;background-color:'+main[i][j].bgColor+";background-image:url("+main[i][j].ico+");border-radius:"+borderRadius+"%;background-size:"+(main[i][j].type=="app"?"80%":"cover")+'"></div>';div+="</div>";div+='<div icon="icon" class="notiNum"></div>';if(main[i][j].type=="setting"||main[i][j].type=="history"||main[i][j].type=="notepad"||main[i][j].type=="bookmarks"||main[i][j].type=="todos"||main[i][j].type=="apps"||main[i][j].type=="weather"){}else{div+='<img icon="icon" type="edit" show="false" style="border-radius:'+borderRadius+'%" draggable="false" class="editico" src="img/edit.png">'}div+='<img icon="icon" draggable="false" class="deleteico" src="img/remove.png">';div+='<div icon="icon" draggable="false" class="iconTitle iconTitle'+(iconNum)+'"><span class="iconTitleSpan">'+(main[i][j].title?main[i][j].title:"")+"</span></div>";div+='<div icon="icon" draggable="false" class="iconName theIconName'+iconNum+' globalColor" style="color:'+fontColor+'" type="">'+main[i][j].name+"</div>";div+="</div>";AllICONNUM+=1}div+="</div>";div+="</div>"}$("#mainAll").html(div);var pointer="";for(var i=0;i<ml;i++){if(i==0){if(ml==1){var style="display:none;background-color:"+i18n("pointColor")}else{var style="background-color:"+i18n("pointColor")}}else{var style=""}pointer+='<div class="point" style="'+style+'"></div>'}$("#pointOut").html(pointer)}};var ___searchLock;var __isAnimate=false;window.$onSlide={ini:function(){$onSlide.prevent();
$onSlide.keyEvent();$onSlide.onClickPointer();$(document).mousewheel(function(e,r){try{if($("#mainAll").children("").length==0){$my.G_SlideOut=false}if($my.G_SlideOut==false||$my.G_SlideLock){}else{e.preventDefault();if(__isAnimate){return false}if(r<0){$onSlide.toLeft("#mainAll")}else{if(r>0){$onSlide.toRight("#mainAll")}}}}catch(e){console.log(e)}})},toLeft:function(a,b){__isAnimate=true;var len=$(".group").length;if(len==1){$(a).transition({x:"-200px"},220,function(){$(a).transition({x:"0"},280,function(){__isAnimate=false})});return false}var width,p,x,n;width=$(a).css("width");width=parseInt(width);n=width/1210;n=Math.round(n);x=$(a).css("x");x=parseInt(x);x-=1210;p=(x-1110)/(-1210);p=parseInt(Math.round(p));if(n==p-1){$(a).css("width",width+1212);$(a).append($(a).children(":first").clone(true));$(a).transition({x:"-=1210",duration:500,easing:"easeOutBack",complete:function(){__isAnimate=false;$(a).children(":last").remove();$(a).css("width",width);$(a).css("x",0);pagebuttonShow("1",b)}})}else{$(a).transition({x:"-=1210",duration:500,easing:"easeOutBack",complete:function(){__isAnimate=false;pagebuttonShow(p,b)}})}},toRight:function(a,b){__isAnimate=true;var len=$(".group").length;if(len==1){$(a).transition({x:"200px"},220,function(){$(a).transition({x:"0"},280,function(){__isAnimate=false})});return false}var width,p,x,n;width=$(a).css("width");width=parseInt(width);n=width/1210;n=Math.round(n);x=$(a).css("x");x=parseInt(x);x+=1210;p=(x-1110)/(-1210);p=parseInt(Math.round(p));if(p==0){$(a).css("width",width+1212);$(a).prepend('<div id="appendDivBefore"></div>');$("#appendDivBefore").append($(a).children(":last").clone(true));$(a).css("x","-1210px");$(a).transition({x:"0px",duration:500,easing:"easeOutBack",complete:function(){__isAnimate=false;$("#appendDivBefore").remove();$(a).css("width",width);$(a).css("x",-1210*(n-1));pagebuttonShow("last",b)}})}else{$(a).transition({x:"+=1210",duration:500,easing:"easeOutBack",complete:function(){__isAnimate=false;pagebuttonShow(p,b)}})}},slideTo:function(a,n,f){var x=n*(-1210);__isAnimate=true;$(a).transition({x:x,duration:500,easing:"easeOutBack",complete:function(){__isAnimate=false;$(".point").css("background-color","");$(".point:nth-child("+(n+1)+")").css("background-color",i18n("pointColor"));try{if(f){f()}}catch(e){}}})},prevent:function(){var theid="";for(var a in $my.slide){theid+="#"+a+"Slide,"}$(theid).live("mouseover",function(event){$my.G_SlideOut=false});$(theid).live("mousemove",function(event){$my.G_SlideOut=false});$(theid).live("mouseleave",function(event){$my.G_SlideOut=true})},keyEvent:function(){___searchLock=true;$("[type=search]").live("focus",function(event){___searchLock=false});$("[type=search]").live("blur",function(event){___searchLock=true});$(document).keydown(function(e){if(e.which==39||e.which==37){if(___searchLock){if($("#mainAll").children("").length==0){return false}if($my.G_SlideOut==false){}else{e.preventDefault();if($("#mainAll").is(":animated")){return false}if(e.which==39){$("#mainAll").stop(false,true);$onSlide.toLeft("#mainAll")}if(e.which==37){$("#mainAll").stop(false,true);$onSlide.toRight("#mainAll")}}}}})},onClickPointer:function(){$(".point").live("click",function(event){var index=$(this).index();$onSlide.slideTo("#mainAll",index)})}};function pagebuttonShow(p,b){$(".point").css("background-color","");if(p=="last"){$(".point:last").css("background-color",i18n("pointColor"))}else{$(".point:nth-child("+p+")").css("background-color",i18n("pointColor"))}if(b){b(p)}}function slideLock(){$my.G_SlideLock=true}function slideUnLock(){$my.G_SlideLock=false}window.$my.$zoom={ini:function(){$(window).resize(function(){var width=$(window).width();var zoom=width/1440;if(zoom<=0.6){zoom=0.6}if(zoom>=2){zoom=2}$("#AllOut").css("zoom",zoom)})}};window.arrayGroupByNum=function(a,b){var icon=[];var iconBig=[];var temp=[];for(var i=0;i<a.length;i++){for(var j=0;j<a[i].length;j++){icon.push(a[i][j])}}var n=Math.ceil(icon.length/b);for(var k=0;k<n;k++){temp=[];var l=(icon.length<=((k+1)*b))?(icon.length):((k+1)*b);for(var i=k*b;i<l;i++){temp.push(icon[i])}iconBig.push(temp)}return iconBig};var G_Infinity_Open_Lock=false;var Show_Noti_Num=true;window.$deleteIcon={ini:function(){G_Infinity_Open_Lock=false;$(".icon").live("mousedown",function(e){if(e.which==3){$(".deleteico").fadeIn(200,function(){$(".icon").css("-webkit-animation","rotate 0.2s ease infinite")});$(".notiNum").hide();$(".editico").attr("show","true");Show_Noti_Num=false;G_Infinity_Open_Lock=true}});$("body").live("mousedown",function(e){if(e.target.className!="deleteico"&&$(e.target).attr("icon")!="icon"){$(".deleteico").fadeOut(200,function(){$(".icon").css("-webkit-animation","")});$(".editico").attr("show","false");setAllNotiNum();G_Infinity_Open_Lock=false;Show_Noti_Num=true}});$(".deleteico").live("click",function(event){$(this).parent().css({"-webkit-animation":"zoomOut 0.2s ease","-webkit-transform":"scale(0)"});var objThis=$(this).parent();setTimeout(function(){var index=objThis.index();
var parentIndex=objThis.parent().parent().index();objThis.remove();var main=localStorage.main;var icon=JSON.parse(main);if(icon[parentIndex].length==1){icon.splice(parentIndex,1);if(parentIndex==0){$onSlide.slideTo("#mainAll",1,function(){$(".group:nth-child("+(parentIndex+1)+")").remove();$(".point:nth-child("+(parentIndex+1)+")").remove();$(".point:nth-child("+(parentIndex+1)+")").css("background-color",i18n("pointColor"));var ml=icon.length;var mainWidth=icon.length*1212;var pointerOutWidth=icon.length*40;$("#pointOut").css("width",pointerOutWidth);$("#mainAll").css({"width":mainWidth,"x":"0"})})}else{$onSlide.slideTo("#mainAll",parentIndex-1,function(){$(".group:nth-child("+(parentIndex+1)+")").remove();$(".point:nth-child("+(parentIndex+1)+")").remove();var ml=icon.length;var mainWidth=icon.length*1212;var pointerOutWidth=icon.length*40;$("#pointOut").css("width",pointerOutWidth);$("#mainAll").css("width",mainWidth)})}}else{icon[parentIndex].splice(index,1)}localStorage.main=JSON.stringify(icon);$setting.sync()},200)})}};window.$Edit={ini:function(){$Edit.onedit();var $editSlide=new $Slide("edit",[i18n("Edit")],"#2ECC71");$editSlide.append();$.loadHtml("#editSlideBigBox","app/edit/edit.html");$Edit.loadEdit();$("#editBoxHover").live("click",function(event){$(this).hide()})},loadEdit:function(){$(".editico").live("click",function(event){$(".deleteico").hide();$(".icon").css("-webkit-animation","")})},onedit:function(){$(".icon").live("mouseover",function(e){var obj=$(this).children(".editico");if(obj.attr("show")=="true"){obj.show()}else{obj.hide()}})}};function RGBToHex(rgb){if(rgb.substring(0,1)=="#"){rgb.toUpperCase();return rgb}var regexp=/[0-9]{0,3}/g;var re=rgb.match(regexp);var hexColor="#";var hex=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];for(var i=0;i<re.length;i++){var r=null,c=re[i],l=c;var hexAr=[];while(c>16){r=c%16;c=(c/16)>>0;hexAr.push(hex[r])}hexAr.push(hex[c]);if(l<16&&l!=""){hexAr.push(0)}hexColor+=hexAr.reverse().join("")}hexColor.toUpperCase();return hexColor}window.$mostVisited={ini:function(){this.get()},get:function(){try{var data=$setting.get("mostVisits");var div="";if(data.length==0){chrome.topSites.get(function(data){for(var i=0;i<data.length;i++){data[i].title=data[i].title.replace("https://","");data[i].title=data[i].title.replace("http://","");div+='<div class="MostItem" url="'+data[i].url+'"><img src="chrome://favicon/'+data[i].url+'"><span>'+data[i].title+"</span></div>"}$("#MostVisitedOut").html(stripscript(div))});return false}for(var i=0;i<data.length;i++){div+='<div class="MostItem" url="'+data[i].url+'"><img src="chrome://favicon/'+data[i].url+'"><span>'+data[i].title+"</span></div>"}$("#MostVisitedOut").html(stripscript(div))}catch(e){console.log(e)}},set:function(){chrome.topSites.get(function(data){for(var i=0;i<data.length;i++){data[i].title=data[i].title.replace("https://","");data[i].title=data[i].title.replace("http://","")}$setting.set("mostVisits",data)});$("[name=mostVisited]").live("change",function(event){var c=$(this).is(":checked");if(c){$("#MostVisitedOut").show()}else{$("#MostVisitedOut").hide()}});$(".MostItem").live("click",function(e){var target="";var openInNewtab=$setting.get("openInNewtab");if(openInNewtab){target="_blank"}else{target="_self"}var url=$(this).attr("url");if(window.event.ctrlKey){window.open(url,"_blank")}else{window.open(url,target)}return false});$(".MostItem").live("mousedown",function(e){if(e.which==2){var url=$(this).attr("url");window.open(url,"_blank");return false}})}};function $loadingIn(a){$(a).html('<div class="loader"><svg class="circular"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg></div>')}function wallpaperToblur(){var url=getBg(true);var img=new Image();img.src=url;img.onload=function(){$("#bgOut").css("background-image","url("+url+")");$setting.set("lastWallpaper",url);img.src=""};img.onerror=function(){failedToloadWp()}}function getBg(a){try{var autoBg=$setting.get("autoWallpaper");var bgType=$setting.get("bgType");var blur=$setting.get("blurWallpaper");var month=new Date().getMonth()+1;var date=new Date().getDate();if(a){blur=!blur}var url="";if(autoBg){var autoType=$setting.get("AutoBgType");if(autoType=="InfinityBg"){if(blur){url="http://img.infinitynewtab.com/InfinityBlur/"+month+"_"+date+".jpg"}else{url="http://img.infinitynewtab.com/InfinityWallpaper/"+month+"_"+date+".jpg"}}else{if(blur){url="http://img.infinitynewtab.com/bingWallpaper/bgblur.jpg?month="+month+"&date="+date}else{url="http://img.infinitynewtab.com/bingWallpaper/bg.jpg?month="+month+"&date="+date}}}else{if(bgType=="default"){if(blur){url="img/bgblur.jpg"}else{url="img/bg.jpg"}}if(bgType=="user"){try{if(localStorage.newLocal){if(blur){url="filesystem:chrome-extension://"+APPID+"/temporary/localBlur.jpg?time="+new Date().getTime()}else{url="filesystem:chrome-extension://"+APPID+"/temporary/local.jpg?time="+new Date().getTime()}}else{try{var wp=$setting.get("bgname");
var name=wp.substring(0,wp.indexOf(".jpg?time="));var nameAfter=wp.substring(wp.indexOf(".jpg?time="),wp.length);if(blur){url=name+"blur"+nameAfter}else{url=name+nameAfter}}catch(e){if(blur){url="http://img.infinitynewtab.com/InfinityBlur/4_15.jpg"}else{url="http://img.infinitynewtab.com/InfinityWallpaper/4_15.jpg"}}}}catch(e){}}if(bgType=="bing"){if(blur){url="http://img.infinitynewtab.com/bingWallpaper/bgblur.jpg?month="+month+"&date="+date}else{url="http://img.infinitynewtab.com/bingWallpaper/bg.jpg?month="+month+"&date="+date}}if(bgType=="infinity"){if(blur){url="http://img.infinitynewtab.com/InfinityBlur/"+month+"_"+date+".jpg"}else{url="http://img.infinitynewtab.com/InfinityWallpaper/"+month+"_"+date+".jpg"}}if(bgType=="random"){var bgname=$setting.get("bgname");if(blur){url="http://img.infinitynewtab.com/randomBlur/"+bgname+".jpg"}else{url="http://img.infinitynewtab.com/wallpaper/"+bgname+".jpg"}}}return url}catch(e){}}function setAutoBg(){var bgUrl=getBg();var img=new Image();img.src=bgUrl;img.onload=function(){$("#bgOut").css("background-image","url("+bgUrl+")");$setting.set("lastWallpaper",bgUrl);var autoBg=$setting.get("autoWallpaper");img.src="";if(autoBg){var autoType=$setting.get("AutoBgType");if(autoType=="InfinityBg"){$setting.set("bgType","infinity")}else{$setting.set("bgType","bing")}}$(img).remove()};failedToloadWp()}function randomWallpaper(){$("#fengche").live("click",function(event){$(this).addClass("xuanzhuan");var blur=$setting.get("blurWallpaper");var i=Math.floor(Math.random()*4050)+1;var url="";if(blur){url="http://img.infinitynewtab.com/randomBlur/"+i+".jpg"}else{url="http://img.infinitynewtab.com/wallpaper/"+i+".jpg"}var img=new Image();img.src=url;img.onload=function(){$("#bgOut").css("background-image","url("+url+")");$setting.set("bgname",i);$setting.set("lastWallpaper",url);$setting.set("bgType","random");$("#fengche").removeClass("xuanzhuan");$setting.set("autoWallpaper",false);img.src="";$("#autoWallpaperButton").removeAttr("checked");$("#autoWallpaperHover").show();$(img).remove()};img.onerror=function(){$("#fengche").removeClass("xuanzhuan");$(img).remove();return false};return false})}function ResizeIconSize(icon,w,callback){try{var canvas=document.createElement("canvas");canvas.width=w;canvas.height=w;var ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);var img=new Image();img.src=icon;img.onload=function(){ctx.drawImage(img,0,0,w,w);var ico=canvas.toDataURL();try{callback(ico)}catch(e){console.log(e)}}}catch(e){console.log(e)}}function startAnimation(){var animate=$setting.get("startAnimation");if(animate){$(".group:nth-child(1)").children().addClass("animationtrue");setTimeout(function(){$(".group").children().removeClass("animationtrue")},730)}}function openWebSite(){$("[type=ico],[type=custom],[type=gmail],[type=gplus],[type=app]").live("click",function(event){if(!G_Infinity_Open_Lock){var url=$(this).attr("url");if(url.substring(0,6)=="app://"){var id=url.substring(6);chrome.management.launchApp(id);return false}var target="";var openInNewtab=$setting.get("openInNewtab");if(openInNewtab){target="_blank"}else{target="_self"}if(window.event.ctrlKey){if(url.indexOf("chrome://")>=0){chrome.tabs.getCurrent(function(tab){var a=tab.index+1;chrome.tabs.create({"index":a,"url":url},function(){return false})});return false}else{window.open(url,"_blank");return false}}else{if(url.indexOf("chrome://")>=0){if(target=="_self"){chrome.tabs.update({url:url});return false}else{chrome.tabs.getCurrent(function(tab){var a=tab.index+1;chrome.tabs.create({"index":a,"url":url},function(){return false})});return false}}else{window.open(url,target)}}return false}});$("[type=ico],[type=custom],[type=gmail],[type=gplus],[type=app]").live("mousedown",function(e){if(!G_Infinity_Open_Lock){if(e.which==2){var url=$(this).attr("url");if(url.substring(0,6)=="app://"){var id=url.substring(6);chrome.management.launchApp(id);return false}if(url.indexOf("chrome://")>=0){chrome.tabs.getCurrent(function(tab){var a=tab.index+1;chrome.tabs.create({"index":a,"url":url},function(){return false})});return false}else{window.open(url,"_blank");return false}}}})}function notiNum(type,n){$("[type="+type+"] .notiNum").show().html(n);if(n==0){$("[type="+type+"] .notiNum").hide()}}function setTodosNotiNum(){var n=$setting.get("todostrue").length;if(n>=99){n="99+"}notiNum("todos",n)}function setGmailNotiNum(){try{if($setting.get("GmailMessage")){var n=parseInt(localStorage.GmailNum);if(n!=NaN){if(n>=99){n="99+"}notiNum("gmail",n)}}else{notiNum("gmail",0)}}catch(e){}}function setAllNotiNum(){setTodosNotiNum();setGmailNotiNum()}function addIcon(icon,callback){try{var main=localStorage.main;var main=JSON.parse(main);var iconNum=$setting.get("iconNum");var arr=iconNum.split("x");var a=parseInt(arr[0]);var b=parseInt(arr[1]);var c=a*b;if(main.length==0){addTo_M(main,icon,true,0,callback)}else{for(var i=0;i<main.length;i++){if(i<main.length-1){if(main[i].length<c){addTo_M(main,icon,false,i,callback);
break}else{continue}}else{if(main[i].length<c){addTo_M(main,icon,false,i,callback);break}else{addTo_M(main,icon,true,i,callback);break}}}}}catch(e){console.log(e)}}function addTo_M(main,icon,isFull,i,callback){if(isFull){main.push([icon]);localStorage.main=JSON.stringify(main);$iconIni.load(main);var num=getCurrentNum();if(i==0&&main[0].length!=num){$(one).css("-webkit-animation","zoom 0.2s ease")}else{$(".point").css("background-color","");$onSlide.slideTo("#mainAll",i+1,function(){});callback(i+1)}$setting.sync()}else{var p=_getCurrentN();main[i].push(icon);localStorage.main=JSON.stringify(main);$iconIni.load(main);$(".point").css("background-color","");if(p==i){$(".point:nth-child("+(i+1)+")").css("background-color",i18n("pointColor"))}else{$onSlide.slideTo("#mainAll",i,function(){});callback(i)}$setting.sync()}}function _getCurrentN(){var ml,p;ml=$("#mainAll").css("x");ml=parseInt(ml);p=ml/(-1210);p=parseInt(Math.round(p));return p}function setWeather(weather,isNew){var TC=($setting.get("temperatureUnit")=="Celsius")?true:false;var un=TC?"℃":"℉";var imgnow;var iconwea;if(!parseInt(weather.TempNow)){iconwea=i18n("Locating");$("[type=weather] .iconName").text(iconwea);imgnow="http://img.infinitynewtab.com/weatherIcon/H.png"}else{iconwea=weather.TempNow+un+" "+weather.cityName;imgnow="http://img.infinitynewtab.com/weatherIcon/"+weather.img}$("#rightCityName").text(weather.cityName+" | "+weekName(new Date().getDay()));$("#weatherDesc").text(weather.desc);$("#weatherTempMin").text(weather.TempMin);$("#weatherTempNow").text(weather.TempNow);$("#weatherTempMax").text(weather.TempMax);$("#HumidityData").text(weather.humidity);$("#WindData").text(weather.wind);$("#PressureOrPM").text(weather.pressure);$("#weatherIconNow").attr("src",imgnow);$("#WeatherTemp2").text(weather.Temp2min+"~"+weather.Temp2max);$("#WeatherTemp3").text(weather.Temp3min+"~"+weather.Temp3max);$("#WeatherTemp4").text(weather.Temp4min+"~"+weather.Temp4max);$("#WeatherTemp5").text(weather.Temp5min+"~"+weather.Temp5max);$("#WeatherTemp6").text(weather.Temp6min+"~"+weather.Temp6max);$("#WeatherIcon2").attr("src","http://img.infinitynewtab.com/weatherIcon/"+weather.img2);$("#WeatherIcon3").attr("src","http://img.infinitynewtab.com/weatherIcon/"+weather.img3);$("#WeatherIcon4").attr("src","http://img.infinitynewtab.com/weatherIcon/"+weather.img4);$("#WeatherIcon5").attr("src","http://img.infinitynewtab.com/weatherIcon/"+weather.img5);$("#WeatherIcon6").attr("src","http://img.infinitynewtab.com/weatherIcon/"+weather.img6);setWeatherBg(imgnow,iconwea);$("[type=weather] .iconName").text(iconwea);$("[type=weather] .iconInIn").css("background-image","url("+imgnow+")");if(isNew){var json=JSON.stringify(weather);localStorage.weather=json;if($setting.get("wcity")==""){$setting.set("wcity",weather.cityName);$setting.set("wcountry",weather.country);$("#CurrentLocation").text(weather.cityName)}}}function getImgByCode(a){a=parseInt(a);var b={};b[0]="F.png";b[1]="F.png";b[2]="F.png";b[3]="OP.png";b[4]="OP.png";b[5]="X.png";b[6]="X.png";b[7]="X.png";b[8]="X.png";b[9]="Q.png";b[10]="X.png";b[11]="R.png";b[12]="R.png";b[13]="GU.png";b[14]="GU.png";b[15]="GU.png";b[16]="W.png";b[17]="X.png";b[18]="X.png";b[19]="JLM.png";b[20]="JLM.png";b[21]="JLM.png";b[22]="JLM.png";b[23]="F.png";b[24]="F.png";b[25]="GU.png";b[26]="Y.png";b[27]="I.png";b[28]="H.png";b[29]="E.png";b[30]="H.png";b[31]="C.png";b[32]="B.png";b[33]="C.png";b[34]="B.png";b[35]="X.png";b[36]="B.png";b[37]="OP.png";b[38]="OP.png";b[39]="OP.png";b[40]="R.png";b[41]="W.png";b[42]="U.png";b[43]="W.png";b[44]="H.png";b[45]="Q.png";b[46]="W.png";b[47]="OP.png";b[3200]="na.png";return b[a]}function setWeatherWeek(){var D=new Date();var w=D.getDay();var d1=weekName((w+1)%7);var d2=weekName((w+2)%7);var d3=weekName((w+3)%7);var d4=weekName((w+4)%7);var d5=weekName((w+5)%7);$("#weatherDate3").text(d2);$("#weatherDate4").text(d3);$("#weatherDate5").text(d4);$("#weatherDate6").text(d5)}function weekName(n){switch(n){case 0:return i18n("Sunday");break;case 1:return i18n("Monday");break;case 2:return i18n("Tuesday");break;case 3:return i18n("Wednesday");break;case 4:return i18n("Thursday");break;case 5:return i18n("Friday");break;case 6:return i18n("Saturday");break}}function FtoC(a){a=parseInt(a);return Math.round((a-32)/1.8)}function CtoF(){a=parseInt(a);return Math.round(a*1.8+32)}function autoWeather(){try{navigator.geolocation.getCurrentPosition(function(position){var lat=position.coords.latitude;var lon=position.coords.longitude;var text=lat+","+lon;$.ajax({url:"http://query.yahooapis.com/v1/public/yql",type:"get",dataType:"json",data:{"q":'select * from weather.forecast where woeid in (select woeid from geo.placefinder where text="'+text+'" and gflags="R")',"format":"json","randomT":new Date().getTime()}}).done(function(data){var w=data.query.results.channel;saveWeather(w)})})}catch(e){console.log(e)}}function getWeatherPerTime(){if($setting.get("wcity")==""){autoWeather()}else{getCityByCity()}setTimeout(function(){getWeatherPerTime()
},1000*60*5)}function getCityByCity(){try{var text=$setting.get("wcity")+","+$setting.get("wcountry");$.ajax({url:"http://query.yahooapis.com/v1/public/yql",type:"get",dataType:"json",data:{"q":'select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="'+text+'")',"format":"json","randomT":new Date().getTime()}}).done(function(data){var w=data.query.results.channel;saveWeather(w)})}catch(e){console.log(e)}}function saveWeather(w){var weather={};var TC=($setting.get("temperatureUnit")=="Celsius")?true:false;weather.cityName=w.location.city;weather.country=w.location.country;weather.desc=w.item.condition.text;weather.TempMin=TC?FtoC(w.item.forecast[0].low):w.item.forecast[0].low;weather.TempNow=TC?FtoC(w.item.condition.temp):w.item.condition.temp;weather.TempMax=TC?FtoC(w.item.forecast[0].high):w.item.forecast[0].high;weather.img=getImgByCode(w.item.condition.code);weather.humidity=w.atmosphere.humidity;weather.wind=w.wind.speed;weather.pressure=Math.round(parseInt(w.atmosphere.pressure));weather.Temp2min=TC?FtoC(w.item.forecast[1].low):w.item.forecast[1].low;weather.Temp3min=TC?FtoC(w.item.forecast[2].low):w.item.forecast[2].low;weather.Temp4min=TC?FtoC(w.item.forecast[3].low):w.item.forecast[3].low;weather.Temp5min=TC?FtoC(w.item.forecast[4].low):w.item.forecast[4].low;weather.Temp2max=TC?FtoC(w.item.forecast[1].high):w.item.forecast[1].high;weather.Temp3max=TC?FtoC(w.item.forecast[2].high):w.item.forecast[2].high;weather.Temp4max=TC?FtoC(w.item.forecast[3].high):w.item.forecast[3].high;weather.Temp5max=TC?FtoC(w.item.forecast[4].high):w.item.forecast[4].high;weather.img2=getImgByCode(w.item.forecast[1].code);weather.img3=getImgByCode(w.item.forecast[2].code);weather.img4=getImgByCode(w.item.forecast[3].code);weather.img5=getImgByCode(w.item.forecast[4].code);setWeather(weather,true)}$("#ChangeCity").live("click",function(event){$my.addButton.removeClass("addButtonToClose");$("#weatherSlide").removeClass("slideOut");$("#bgOut").removeClass("bgMoveOut");$("#bgImg").removeClass("bgMoveOut");$my.slide["weather"]=false;__Weather_focus=true;$my.addButton.addClass("addButtonToClose");$("#settingSlide").css("visibility","visible");$("#settingSlide").addClass("slideOut");$("#bgOut").addClass("bgMoveOut");$("#bgImg").addClass("bgMoveOut");$my.slide["setting"]=true;$(".topMenu").css("border-bottom","");$("[with=setting1]").css("border-bottom","solid 2px #fdfdfd");$("#setting0SlideBox").hide();$("#setting1SlideBox").show();$("#setting1SlideMenu").show();$(".ST").css("color","");$("#GeneralST").css("color","#2ECC71");$(".settingBox").hide();$("#settingBoxGeneralST").show();$("#setting1SlideBox").scrollTop(1000)});function setWeatherBg(img,text){try{var main=JSON.parse(localStorage.main);for(var i=0;i<main.length;i++){for(var j=0;j<main[i].length;j++){if(main[i][j].type=="weather"){main[i][j].ico=img;main[i][j].name=text}}}localStorage.main=JSON.stringify(main)}catch(e){}}function weatherStart(){if(!localStorage.weather){var weather={cityName:"",country:"",desc:"",TempMin:"",TempNow:"",TempMax:"",humidity:"",wind:"",pressure:"",Temp2min:"N",Temp3min:"N",Temp4min:"N",Temp5min:"N",Temp2max:"A",Temp3max:"A",Temp4max:"A",Temp5max:"A",img:"na.png",img2:"na.png",img3:"na.png",img4:"na.png",img5:"na.png"};var json=JSON.stringify(weather);localStorage.weather=json}else{var weather=JSON.parse(localStorage.weather);setWeather(weather,false)}getWeatherPerTime()}function whenLogin(user){$("#loginOrRegister,#feedbackEmail").val(user.email);$("#cloudBackupHover").hide();if(localStorage.backupIn){$("#lastBackupAt").text(i18n("lastBackupAt")+localStorage.backupIn)}else{$("#lastBackupAt").text("")}$("#loginUploadWp").text(i18n("yourWallpaper"))}function whenUnlogin(user){$("#loginOrRegister").val(i18n("SignInOrRegister"));$("#cloudBackupHover").show();$("#lastBackupAt").text(i18n("SignInToUseTheFeature"));$("#loginUploadWp").text(i18n("UploadLocalWallpaper"))}function onAddbuttonOpen(){try{ga("send","event","侧边栏","click","通过添加按钮打开");ga("send","event","添加与设置","click","添加")}catch(e){}}function GoogleAnalyze(){try{$("[type=setting]").live("click",function(event){ga("send","event","侧边栏","click","通过设置按钮打开");ga("send","event","添加与设置","click","设置")});$("#infinitySearch").live("focus",function(event){var se=$setting.get("searchEngine");ga("send","event","搜索引擎","search",se);ga("send","event","浏览器","browser","All Chrome")});$("#fengche").live("click",function(event){ga("send","event","小风车","click","小风车")});$("[type=todos]").live("click",function(event){ga("send","event","侧边栏","click","待办事项")});$("[type=weather]").live("click",function(event){ga("send","event","侧边栏","click","天气")});$("[type=apps]").live("click",function(event){ga("send","event","侧边栏","click","应用与扩展")});$("[type=history]").live("click",function(event){ga("send","event","侧边栏","click","历史记录")});$("[type=notepad]").live("click",function(event){ga("send","event","侧边栏","click","笔记")});$("[type=bookmarks]").live("click",function(event){ga("send","event","侧边栏","click","书签")
});$("[type=ico]").live("mousedown",function(event){try{var url="undefined";var theurl=$(this).attr("url");url=new URL(theurl).hostname;var w=url.indexOf("www");if(w==0){var l=url.length;var p=url.indexOf(".");url=url.substring(p+1,l)}ga("send","event","预设网站","click",url);ga("send","event","全部网站","click",url);ga("send","event","图标总数","load",AllICONNUM)}catch(e){}});$("[type=custom]").live("mousedown",function(event){try{var url="undefined";var theurl=$(this).attr("url");url=new URL(theurl).hostname;var w=url.indexOf("www");if(w==0){var l=url.length;var p=url.indexOf(".");url=url.substring(p+1,l)}ga("send","event","自定义网站","click",url);ga("send","event","全部网站","click",url)}catch(e){}})}catch(e){}}function getAds(){var now=new Date().getTime();if(!localStorage.LastAdTime){localStorage.LastAdTime=0}var LastAdTime=parseInt(localStorage.LastAdTime);var d=(now-LastAdTime)/1000/60/60/24;if(d<4){return false}var url;if(isZh()){url="http://api.infinitynewtab.com/Ads/Ads_zh.json"}else{url="http://api.infinitynewtab.com/Ads/Ads_en.json"}$.ajax({url:url,dataType:"json"}).done(function(data){if(data.infinityType=="infinity"){if(data.showAd=="true"){$("#getAds").show().attr({"src":data.img,"url":data.url}).css({"width":data.width,"height":data.height,"left":data.left})}else{$("#getAds").hide()}}});$("#getAds").click(function(event){var url=$(this).attr("url");window.open(url,"_blank");$("#getAds").hide();localStorage.LastAdTime=new Date().getTime()})}function showTopBar(){load_bookmarks();$mostVisited.ini();bookmarks();HowTpShowTop();$("#displayAtTopButton,[name=displayTopType]").live("click",function(event){HowTpShowTop()})}function HowTpShowTop(){var isDisplayTop=$setting.get("displayAtTop");var dt=$setting.get("displayTopType");if(isDisplayTop){if(dt=="Bookmarksbar"){$(".BookmarkBar").show();$("#MostVisitedOut").hide()}else{if(dt=="mostVisited"){$("#MostVisitedOut").show();$(".BookmarkBar").hide()}}}else{$(".BookmarkBar").hide();$("#MostVisitedOut").hide()}}function failedToloadWp(){if(window.navigator.onLine==true){}else{$("#wallpaperErrorShow").show()}}(function(){$.ajax({url:"http://suggestion.baidu.com/su?wd="}).fail(function(){if(window.navigator.onLine==true){}else{$.ajax({url:"http://google.com/complete/search?client=chrome&q="}).fail(function(){$("#wallpaperErrorShow").show()})}});$("#closefailed").live("click",function(event){$("#wallpaperErrorShow").fadeOut(100)})})();function checkAdd(type,url){try{var main=JSON.parse(localStorage.main);var ml=main.length;if(type==""||type=="ico"){for(var i=0;i<ml;i++){for(var j=0;j<main[i].length;j++){if(main[i][j].url==url){return true;break}}}return false}else{for(var i=0;i<main.length;i++){for(var j=0;j<main[i].length;j++){if(main[i][j].type==type){return true;break}}}}return false}catch(e){return false}}function checkappAdd(url){try{var main=JSON.parse(localStorage.main);var ml=main.length;for(var i=0;i<ml;i++){for(var j=0;j<main[i].length;j++){if(main[i][j].url==("app://"+url)){return true;break}}}return false}catch(e){console.log(e)}}function onError(e){console.log(e)}function saveAllImage(fl,u,callback){try{var filer=fl;if(GetOriginalImage){GetOriginalImage.abort()}GetOriginalImage=$.ajax({url:u,dataType:"binary",processData:false,}).done(function(data){filer.write("local.jpg",{data:data,type:"image/jpeg"},function(fileEntry,fileWriter){saveBlurImage(filer,u,callback)},onError)})}catch(e){console.log(e)}}function saveBlurImage(filer,u,callback){try{var ImageWidth=$(window).width();setBlurWallpaperBase64(u,ImageWidth,BlurRadius,function(img){var uint8=convertDataURIToBinary(img);filer.write("localBlur.jpg",{data:uint8,type:"image/jpg"},function(fileEntry,fileWriter){callback()},onError)})}catch(e){console.log(e)}}function convertDataURIToBinary(dataURI){var BASE64_MARKER=";base64,";var base64Index=dataURI.indexOf(BASE64_MARKER)+BASE64_MARKER.length;var base64=dataURI.substring(base64Index);var raw=window.atob(base64);var rawLength=raw.length;var array=new Uint8Array(new ArrayBuffer(rawLength));for(var i=0;i<rawLength;i++){array[i]=raw.charCodeAt(i)}return array}function setBlurWallpaperBase64(w,ww,c,callback){try{if(c){var r=c}else{var r=16}var canvas=document.getElementById("iconCanvas");canvas.width=ww;var ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);var img=new Image();img.src=w;img.onload=function(){var x=ww;var y=Math.round((ww/img.width)*img.height);canvas.width=x;canvas.height=y;ctx.drawImage(img,0,0,x,y);stackBlurCanvasRGB("iconCanvas",0,0,x,y,r);var ico=canvas.toDataURL();try{callback(ico)}catch(e){console.log(e)}ctx.clearRect(0,0,canvas.width,canvas.height)}}catch(e){console.log(e)}}function xmlToJson(xml){var obj={};if(xml.nodeType==1){if(xml.attributes.length>0){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.value}}}else{if(xml.nodeType==3){obj=xml.nodeValue}}if(xml.hasChildNodes()){for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i);
var nodeName=item.nodeName;if(typeof(obj[nodeName])=="undefined"){obj[nodeName]=xmlToJson(item)}else{if(typeof(obj[nodeName].length)=="undefined"){var old=obj[nodeName];obj[nodeName]=[];obj[nodeName].push(old)}obj[nodeName].push(xmlToJson(item))}}}return obj}function $gmail(){try{var gmail=$setting.get("GmailMessage");if(gmail){if(Gmail_Ajax){Gmail_Ajax.abort()}Gmail_Ajax=$.ajax({url:"https://mail.google.com/mail/u/0/feed/atom/?timestamp="+new Date().getTime(),dataType:"xml"}).done(function(data,ajaxa,ajaxb){try{if(ajaxb.status==401){localStorage.gmailLogin="false";$setting.set("GmailMessage",false);$("#GmailMessageCheck").prop("checked",false);return false}localStorage.gmailLogin="true";var obj=xmlToJson(data);var n=obj.feed.fullcount["#text"];n=parseInt(n);localStorage.GmailNum=n;if(Show_Noti_Num){setGmailNotiNum()}setTimeout(function(){$gmail()},1000*3)}catch(e){}}).fail(function(s){if(s.status==401){localStorage.gmailLogin="false";$setting.set("GmailMessage",false);$("#GmailMessageCheck").prop("checked",false);if(Show_Noti_Num){setGmailNotiNum()}setTimeout(function(){$gmail()},1000)}})}else{setTimeout(function(){$gmail()},1000)}}catch(e){console.log(e)}}function html2Escape(sHtml){return sHtml.replace(/[<>&"]/g,function(c){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[c]})}function stripscript(s){return s.replace(/<script.*?>.*?<\/script>/ig,"")};