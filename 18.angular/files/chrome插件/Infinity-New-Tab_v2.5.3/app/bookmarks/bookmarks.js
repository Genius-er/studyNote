$(document).ready(function(){function a(c){return Object.prototype.toString.call(c)==="[object Array]"}window.$bookmarks={ini:function(){try{$bookmarks.onClickFolder();$bookmarks.onSearch();$bookmarks.onOpen();chrome.bookmarks.getTree(function(e){var d=e[0];$bookmarks.bookmarksFolder=[];$bookmarks.getIn(d);$bookmarks.showFolders($bookmarks.bookmarksFolder)})}catch(c){}},bookmarksFolder:[],onSearch:function(){$("#searchBookmarks").live("input",function(e){$(".bookmarksFolders").css({"color":"","background-color":""});$("#searchFolder").css({"height":"40px"});$("#bookmarksLeft").animate({scrollTop:"0px"},200);var d=$(this).val();chrome.bookmarks.search(d,function(f){$bookmarks.showSearchResult(f)});if($(this).val()==""){$(".bookmarksFolders").css({"color":"","background-color":""});$("#searchFolder").css({"height":"0px"});$(".bookmarksFolders:nth-child(2)").css({"color":"#fdfdfd","background-color":"#2980B9"});var c=$(".bookmarksFolders:nth-child(2)").attr("bookmarkfolderid");$bookmarks.getBookmarks(c)}})},showFolders:function(e){var g="";for(var c=0;c<$bookmarks.bookmarksFolder.length;c++){if(c==0){$bookmarks.getBookmarks($bookmarks.bookmarksFolder[0].id);var d="	background-color: #2980B9;color:#fdfdfd;";g+='<div class="bookmarksFolders" id="searchFolder" bookmarkfolderid="'+$bookmarks.bookmarksFolder[c].id+'">'+i18n("search")+"</div>"}else{var d=""}g+='<div class="bookmarksFolders" style="'+d+'" title="'+$bookmarks.bookmarksFolder[c].title+'" bookmarkfolderid="'+$bookmarks.bookmarksFolder[c].id+'">'+$bookmarks.bookmarksFolder[c].title+"</div>"}$("#bookmarksLeft").html(stripscript(g))},getIn:function(d){if(typeof(d)=="object"&&!a(d)){for(var f in d){if(f=="children"){try{if(typeof(d[f]["dateGroupModified"])!="undefined"||typeof(d[g]["url"])=="undefined"){var j={id:d[f].id,title:d[f].title};$bookmarks.bookmarksFolder.push(j)}}catch(h){}$bookmarks.getIn(d[f])}}}if(a(d)){for(var g=0;g<d.length;g++){try{if(typeof(d[g]["dateGroupModified"])!="undefined"||typeof(d[g]["url"])=="undefined"){var j={id:d[g].id,title:d[g].title};$bookmarks.bookmarksFolder.push(j)}}catch(h){}$bookmarks.getIn(d[g])}}},getBookmarks:function(c){chrome.bookmarks.getChildren(c,function(f){var h="";for(var d=0;d<f.length;d++){try{f[d].url=html2Escape(f[d].url);if(typeof(f[d]["dateGroupModified"])=="undefined"&&typeof(f[d]["url"])!="undefined"){h+='<div class="bookmarksItem" url="'+f[d].url+'" title="'+(f[d].title?f[d].title:f[d].url)+'">';h+='<img src="chrome://favicon/'+f[d].url+'" class="bookmarksIcon">';h+='<div class="bookmarksName">'+(f[d].title?f[d].title:f[d].url)+"</div>";h+="</div>"}}catch(g){continue}}$("#bookmarksRight").html(stripscript(h))})},showSearchResult:function(d){var g="";for(var c=0;c<d.length;c++){try{d[c].url=html2Escape(d[c].url);if(typeof(d[c]["dateGroupModified"])=="undefined"&&typeof(d[c]["url"])!="undefined"){g+='<div class="bookmarksItem" url="'+d[c].url+'" title="'+(d[c].title?d[c].title:d[c].url)+'">';g+='<img src="chrome://favicon/'+d[c].url+'" class="bookmarksIcon">';g+='<div class="bookmarksName">'+(d[c].title?d[c].title:d[c].url)+"</div>";g+="</div>"}}catch(f){continue}}$("#bookmarksRight").html(stripscript(g))},onClickFolder:function(){$(".bookmarksFolders").live("click",function(c){$(".bookmarksFolders").css({"color":"","background-color":""});$("#searchFolder").css({"height":"0px"});$(this).css({"color":"#fdfdfd","background-color":"#2980B9"});var d=$(this).attr("bookmarkfolderid");$bookmarks.getBookmarks(d)})},onOpen:function(){$(".bookmarksItem").live("click",function(e){var d=$(this).attr("url");var f=$setting.get("OpenBookmarksInNewtab");if(d.indexOf("chrome://")==0){chrome.tabs.getCurrent(function(h){var g=h.index+1;chrome.tabs.create({"index":g,"url":d},function(){return false})})}else{if(f){var c="_blank"}else{var c="_self"}if(window.event.ctrlKey){window.open(d,"_blank")}else{window.open(d,c)}}});$(".bookmarksItem").live("mousedown",function(d){var c=$(this).attr("url");if(d.which==2){if(c.indexOf("chrome://")==0){chrome.tabs.getCurrent(function(f){var e=f.index+1;chrome.tabs.create({"index":e,"url":c},function(){return false})})}else{window.open(c,"_blank")}return false}})}};try{$bookmarks.ini()}catch(b){}});