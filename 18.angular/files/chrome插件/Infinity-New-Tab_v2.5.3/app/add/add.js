"use strict";var siteTitleSuggestAjax=null;var searchWebIconAjax=null;var WebIconAjax=null;var uploadAjax=null;var isBase64Image=false;var dataRest=false;$(document).ready(function(){$("#flat1").spectrum({preferredFormat:"rgb",flat:true,showInput:true});var a=(Math.round($setting.get("iconFillet"))/2)+"%";$("#iconPreviewTop").css("border-radius",a);window.$Add={ini:function(){$Add.Menu()},Menu:function(){$(".ADD").live("click",function(c){var b=$(this).index();$(".ADD").css("color","");$(this).css("color","#2ECC71");$(".addContain").hide();$("#addContain"+b).show()});$("#addfeedbackMenu").live("click",function(b){if(isLogin()){$("#feedbackText")[0].focus()}else{$("#feedbackEmail")[0].focus()}});$("#addCustomButton").live("click",function(b){$("#addUrl")[0].focus()});$("#addfeedbackMenu").live("click",function(b){$("#feedbackText").val("");$("#allFeedback").removeClass("loginBoxHide");$("#thankFeedback").hide()})}};window.$addIcon={ini:function(){this.addCustom();this.resizeImg();this.selectColor()},addCustom:function(){$("#addUrl").live("input",function(c){var b=$(this).val();if(b.length>=5){if(b.substring(0,4)!="http"){b="http://"+b}}if(checkeURL(b)){try{if(siteTitleSuggestAjax){siteTitleSuggestAjax.abort()}siteTitleSuggestAjax=$.ajax({url:b,dataType:"text"}).done(function(e){var d=/<title>(.*)<\/title>/;var g=e.match(d)[1];$("#addTitle").val(g);$("#previewName").text(g);var f=g.substring(0,4);if($("#iconPreview").attr("bgImg")==""){$("#iconPreview").text(f)}})}catch(c){}}});$("#addTitle").live("input",function(b){var d=$(this).val();var c="";$("#previewName").text(d);c=d.substring(0,4);if($("#iconPreview").attr("bgImg")==""){if(d==""){$("#previewName").text(i18n("addTitle"))}$("#iconPreview").text(c)}});$("#addBu").live("click",function(b){try{var c=$("#addTitle").val();var d=$("#addUrl").val();if(d.indexOf("://")>0||d.indexOf("mailto:")>=0){}else{d="http://"+d}var l=$("#iconPreviewTop").css("background-color");var h=$("#iconPreview").attr("bgImg");var k=$("#iconPreview").text();if(h==""){var j={"type":"custom","name":c,"url":d,"bgColor":l,"title":k,"ico":h};$addIcon.addIcon(j)}else{try{var o=new Image();o.src=h;var f=document.createElement("canvas");var n=f.getContext("2d");f.width=300;f.height=300;n.fillStyle=l;n.fillRect(0,0,300,300);n.drawImage(o,0,0,300,300);var g=f.toDataURL()}catch(i){}var m=$("#isShareIcon").is(":checked")?"1":"0";if(m=="1"){uploadAjax=$.ajax({url:"http://admin.infinitynewtab.com/uploadicon/GetIcons.php",type:"POST",data:{"iconName":c,"iconAddress":d,"iconShare":"1","country":isZh()?"1":"0","iconBase64":g.substring(22)},}).done(function(){})}ResizeIconSize(h,150,function(e){ResizeIconSize(e,120,function(q){var p={"type":"custom","name":c,"url":d,"bgColor":l,"title":k,"ico":q};$addIcon.addIcon(p)})})}}catch(i){console.log(i)}})},resizeImg:function(){try{$("#uploadImage").live("click",function(c){$(this).val("")});$("#uploadImage")[0].onchange=function(){try{$("#iconPreview").text("");var g=this.files[0];var c=new FileReader();var f=document.getElementById("mycanvas");var d=f.getContext("2d");c.onload=function(j){var i=new Image();i.onload=function(){$(f).attr("cimg",i.src);f.width=300;f.height=300;var e=300;var k=Math.round(300*i.height/i.width);var m=Math.round((300-e)/2);var l=Math.round((300-k)/2);d.drawImage(i,m,l,e,k);$("#iconPreview").attr("bgImg",f.toDataURL());$("#iconPreview").attr({"left":m,"top":l})};i.src=j.target.result};c.readAsDataURL(g);$("#remove,#imgSize,#imageSize,.adjustBu,#shareIcon").fadeIn(100);$("#iconPreview").attr("dragMove","true");$("#iconPreviewTop").css({"background-color":"transparent","background-image":"url(../img/transparent.png)"});$(".icobgColor").css("border-color","transparent");$("#transparentBg").css("border-color","#ccc")}catch(h){}}}catch(b){}$("#imgSize").live("input",function(j){$("#iconPreview").text("");var m=$(this).val();var c=document.getElementById("mycanvas");var n=c.getContext("2d");n.clearRect(0,0,c.width,c.height);var g=$(c).attr("cimg");var f=new Image();f.src=g;var l=m;var i=Math.round((m*f.height/f.width));var d=Math.round((300-l)/2);var k=Math.round((300-i)/2);n.drawImage(f,d,k,l,i);$("#iconPreview").attr({"left":d,"top":k});$("#iconPreview").attr("bgImg",c.toDataURL())});$("#iconPreviewTop").live("mousedown",function(g){var c=g.pageX;var h=g.pageY;var f=$("#iconPreview").attr("left");var d=$("#iconPreview").attr("top");$("#iconPreview").attr({"useleft":f,"usetop":d});$(this).attr({"x":c,"y":h})});$("#iconPreviewTop").live("mousemove",function(t){if(t.which==1){if($("#iconPreview").attr("dragMove")=="true"){$("#iconPreview").text("");var k=$("#imgSize").val();var o=parseInt($(this).attr("x"));var n=parseInt($(this).attr("y"));var i=(t.pageX);var g=(t.pageY);var c=Math.round($("#iconPreview").attr("useleft"));var u=Math.round($("#iconPreview").attr("usetop"));var r=c+((i-o)*3);var q=u+((g-n)*3);var d=document.getElementById("mycanvas");var p=d.getContext("2d");p.clearRect(0,0,d.width,d.height);var z=$(d).attr("cimg");var m=new Image();
m.src=z;var j=k;var s=Math.round((k*m.height/m.width));var f=Math.round((300-j)/2);var l=Math.round((300-s)/2);p.drawImage(m,f+r,f+q,j,s);$("#iconPreview").attr("left",r);$("#iconPreview").attr("top",q);$("#iconPreview").attr("bgImg",d.toDataURL())}}});$("#remove").click(function(f){$("#iconPreview").css("background-image","");$("#iconPreview").attr("bgImg","");$("#iconPreview").attr({"top":"0","left":"0"});$("#uploadImage").val("");var e=document.getElementById("mycanvas");var c=e.getContext("2d");c.clearRect(0,0,e.width,e.height);$("#remove,#imgSize,#imageSize,.adjustBu,#shareIcon").fadeOut(100);$("#iconPreview").text($("#addTitle").val().substring(0,4));$("#iconPreview").attr("dragMove","false");$(".icobgColor").css("border-color","transparent");var d=$(".icobgColorPre:nth-child(1)").css("background-color");$(".icobgColorPre:nth-child(1)").css("border-color",d);$("#iconPreviewTop").css({"background-color":d,"background-image":""})})},selectColor:function(){$(".addButton").live("click",function(c){if(isAllSlideFalse()){}else{$(".icobgColor").css("border-color","transparent");var b=$(".icobgColorPre:nth-child(1)").css("background-color");$(".icobgColorPre:nth-child(1)").css("border-color",b);$("#iconPreviewTop").css({"background-color":b,"background-image":""})}});$(".icobgColorPre").live("click",function(c){$(".icobgColor").css("border-color","transparent");var b=$(this).css("background-color");$(this).css("border-color",b);$("#iconPreviewTop").css({"background-color":b,"background-image":""})});$(".sp-input").attr("disabled","disabled");$("#ColorPicker").click(function(){if($(this).attr("show")=="true"){$("#picker").fadeOut(100);var b=$("#picker .sp-input").val();$("#iconPreviewTop").css({"background-color":b});$(".icobgColor").css("border-color","");$("#ColorPicker").css("border-color",b);$(this).attr("show","false")}else{$("#picker").fadeIn(100);$(this).attr("show","true")}});$("#picker").live("mousemove",function(c){if(c.which==1){var b=$("#picker .sp-input").val();$(".icobgColor").css("border-color","");$("#iconPreviewTop").css({"background-color":b,"background-image":""});$("#ColorPicker").css("border-color",b)}});$(document).mousedown(function(b){if(b.target.id!="picker"&&b.target.id!="addBu"){if(b.target.id=="ColorPicker"){}else{$("#picker").fadeOut(100);$("#ColorPicker").attr("show","false")}}});$("#transparentBg").live("click",function(b){$(".icobgColor").css("border-color","");$(this).css("border-color","#ccc");$("#iconPreviewTop").css({"background-color":"transparent","background-image":"url(../img/transparent.png)"})})},addIcon:function(l){try{var d=localStorage.main;var d=JSON.parse(d);var f=$setting.get("iconNum");var h=f.split("x");var n=parseInt(h[0]);var m=parseInt(h[1]);var k=n*m;if(d.length==0){$addIcon.addTo(d,l,true,0)}else{for(var g=0;g<d.length;g++){if(g<d.length-1){if(d[g].length<k){$addIcon.addTo(d,l,false,g);break}else{continue}}else{if(d[g].length<k){$addIcon.addTo(d,l,false,g);break}else{$addIcon.addTo(d,l,true,g);break}}}}}catch(j){console.log(j)}},getCurrentN:function(){var c,b;c=$("#mainAll").css("x");c=parseInt(c);b=c/(-1210);b=parseInt(Math.round(b));return b},addTo:function(b,g,f,e){if(f){b.push([g]);localStorage.main=JSON.stringify(b);$iconIni.load(b);var j=$(".groupIn")[e+1];var d=$(j).children().last()[0];var c=getCurrentNum();if(e==0&&b[0].length!=c){$(d).css("-webkit-animation","zoom 0.2s ease")}else{$(".point").css("background-color","");$(d).hide();$onSlide.slideTo("#mainAll",e+1,function(){$(d).show();$(d).css("-webkit-animation","zoom 0.2s ease")})}$setting.sync()}else{var h=$addIcon.getCurrentN();b[e].push(g);localStorage.main=JSON.stringify(b);$iconIni.load(b);$(".point").css("background-color","");var j=$(".groupIn")[e];var d=$(j).children().last()[0];$(d).css("-webkit-animation","zoom 0.2s ease");if(h==e){$(".point:nth-child("+(e+1)+")").css("background-color",i18n("pointColor"))}else{$(d).hide();$onSlide.slideTo("#mainAll",e,function(){$(d).show();$(d).css("-webkit-animation","zoom 0.2s ease")})}$setting.sync()}}};window.$infinityIcon={ini:function(){if($my.slide.setting){$infinityIcon.loadPopularIcon()}$("[with=setting0]").live("click",function(b){$infinityIcon.loadPopularIcon();$(".addCategory").css({"background-color":"","color":""});$(".addCategory:nth-child(2)").css({"background-color":"#2ECC71","color":"#fdfdfd"})});$infinityIcon.addInfinityIcons();$infinityIcon.showCategoryIcons();$infinityIcon.webCateMenu();$infinityIcon.webIconSearch();$infinityIcon.webIconAdd();$infinityIcon.onFeedback();$infinityIcon.loadMore()},webCateMenu:function(){$(".addCategory").live("click",function(b){$(".addCategory").css({"background-color":"","color":""});$(this).css({"background-color":"#2ECC71","color":"#fdfdfd"});$(".addCategorySearch").css("height","0px")})},addInfinityIcons:function(){$.ajax({url:"http://img.infinitynewtab.com/files/Category.json",dataType:"json"}).done(function(b){$infinityIcon.showAddCate(b)}).fail(function(){console.log("error")})},showAddCate:function(d){try{var g="";
for(var b=0;b<d.item.length;b++){var c="";if(b==0){g+='<div class="addCategorySearch" style="height:0px;" cate="" title="">'+i18n("searchItem")+"</div>";c="background-color:#2ECC71;color:#fdfdfd;"}g+='<div class="addCategory" style="'+c+'" cate="'+d.item[b].id+'" title="'+i18n(d.item[b].name)+'">';g+=i18n(d.item[b].name);g+="</div>"}$("#addLeft").html(g)}catch(f){}},showCategoryIcons:function(){$(".addCategory").live("click",function(c){$("#addRightTop").html("");var b=$(this).attr("cate");if(b=="tools&apps"){$infinityIcon.addApps()}$loadingIn("#addRight");var d=1;isZh()?d=1:d=0;if(WebIconAjax){WebIconAjax.abort()}WebIconAjax=$.ajax({url:"http://app.infinitynewtab.com/typelist.php?time=0&typename="+encodeURIComponent(b)+"&lang="+d,dataType:"json"}).done(function(e){$infinityIcon.showWebIcons(e)}).fail(function(){console.log("error")}).complete(function(f,e){if(e=="timeout"){}})})},showWebIcons:function(g,c){try{if(c){var b=g.length;var k=$("#addSearch").val();if(k==""||k.length<2){$infinityIcon.loadPopularIcon();return false}}else{var b=(g.length)<=20?(g.length):20}try{dataRest=g.slice(20,g.length)}catch(h){dataRest=false}var j="";var d=Math.round($setting.get("iconFillet"))/2;for(var f=0;f<b;f++){j+='<div class="webIconItem" icondata=\'{"name":"'+g[f].name+'","iconid":"'+g[f].id+'","type":"'+g[f].infinityType+'","ico":"'+g[f].src+'","url":"'+g[f].url+'","title":""}\' title="'+g[f].name+'">';if(checkAdd(g[f].infinityType,g[f].url)){j+='<img class="checkAdd" style="border-radius:'+d+'%;" src="img/checkAdd.png">'}else{j+='<img class="checkAdd" style="border-radius:'+d+'%;display:none" src="img/checkAdd.png">'}j+='<img class="webIconImg" style="border-radius:'+d+'%;" src="'+g[f].src+'" alt="">';j+='<div class="webIconName">'+g[f].name+"</div>";j+="</div>"}$("#addRight").html(j);$("#addRight").scrollTop(0)}catch(h){}},showRestIcons:function(){try{if(dataRest){if(dataRest.length==0){return false}else{var d=dataRest.slice(0,(dataRest.length)<=20?(dataRest.length):20);dataRest=dataRest.slice(20,dataRest.length);var g="";var b=Math.round($setting.get("iconFillet"))/2;for(var c=0;c<d.length;c++){g+='<div class="webIconItem" icondata=\'{"name":"'+d[c].name+'","iconid":"'+d[c].id+'","type":"'+d[c].infinityType+'","ico":"'+d[c].src+'","url":"'+d[c].url+'","title":""}\' title="'+d[c].name+'">';if(checkAdd(d[c].infinityType,d[c].url)){g+='<img class="checkAdd" style="border-radius:'+b+'%;" src="img/checkAdd.png">'}else{g+='<img class="checkAdd" style="border-radius:'+b+'%;display:none" src="img/checkAdd.png">'}g+='<img class="webIconImg" style="border-radius:'+b+'%;" src="'+d[c].src+'" alt="">';g+='<div class="webIconName">'+d[c].name+"</div>";g+="</div>"}$("#addRight").append(g)}}}catch(f){console.log(f)}},webIconSearch:function(){try{$("#addSearch").live("input",function(d){var c=$(this).val();$("#addLeft").scrollTop(0);if(c!=""){$("#addRightTop").html("");$(".addCategorySearch").css({"height":"","color":"#fdfdfd"});$(".addCategory").css({"background-color":"","color":""})}else{$(".addCategorySearch").css("height","0px");$(".addCategory:nth-child(2)").css({"background-color":"#2ECC71","color":"#fdfdfd"});$infinityIcon.loadPopularIcon();return false}if(searchWebIconAjax){searchWebIconAjax.abort()}searchWebIconAjax=$.ajax({url:"http://app.infinitynewtab.com/typelist.php?time="+new Date().getTime()+"&typename=search&keyword="+encodeURIComponent(c)+"&lang="+(isZh()?"1":"0"),dataType:"json"}).done(function(e){$infinityIcon.showWebIcons(e,true)}).fail(function(){console.log("error")})})}catch(b){}},webIconAdd:function(){try{$(".webIconItem").live("click",function(d){var c=JSON.parse($(this).attr("icondata"));var f=c.iconid;if(c.type==""){c.type="ico"}if(c.type=="weather"){c.bgColor="#7adaff"}$.get("http://app.infinitynewtab.com/rate.php?id="+f);$addIcon.addIcon(c);$(this).children(".checkAdd").show();if(c.type=="weather"){var e=JSON.parse(localStorage.weather);setWeather(e,false)}});$(".appIconOutAdd").live("click",function(d){var c={};c.name=$(this).attr("name");c.url="app://"+$(this).attr("appAddid");c.title="";c.type="app";c.ico=$(this).attr("img");c.bgColor="#fdfdfd";$addIcon.addIcon(c);$(this).children(".checkAdd").show()})}catch(b){console.log(b)}},loadPopularIcon:function(){$loadingIn("#addRight");if(WebIconAjax){WebIconAjax.abort()}WebIconAjax=$.ajax({url:"http://app.infinitynewtab.com/typelist.php?time=0&typename=popular&lang="+(isZh()?"1":"0"),dataType:"json"}).done(function(b){$infinityIcon.showWebIcons(b)}).fail(function(){setTimeout(function(){$("#addRight").html('<div id="networkerror">'+i18n("NETWORKERROR")+"<div>")},1000)}).complete(function(c,b){if(b=="timeout"){}})},onFeedback:function(){$("#feedbackSubmit").live("click",function(b){$("#feedbackHover").fadeIn(200);$.ajax({url:"manifest.json",type:"GET",dataType:"json"}).done(function(g){var f=g.version;var e=$("#feedbackEmail").val();var d=$("#feedbackText").val();if(d==""){setTimeout(function(){$("#allFeedback").addClass("loginBoxHide");$("#feedbackHover").fadeOut(200,function(){$("#thankFeedback").show()
})},1500)}else{var j=navigator.userAgent.toLowerCase();var c=navigator.language;var i=i18n("extname");var h="Chrome版本为:"+j+";<br>语言为："+c+";<br>来自:"+i+";<br>版本为:"+f+"。";$.ajax({url:"http://api.infinitynewtab.com/feedback.php",type:"POST",data:{"user":e,"txt":d,"info":h}}).done(function(k){$("#allFeedback").addClass("loginBoxHide");$("#feedbackHover").fadeOut(200,function(){$("#thankFeedback").show()})})}}).error(function(c){console.log(c)})})},addApps:function(){chrome.management.getAll(function(f){var b=f.length;var g="";var c=Math.round($setting.get("iconFillet"))/2;for(var d=0;d<b;d++){if(f[d].isApp){var e=f[d].icons[f[d].icons.length-1].url;g+='<div class="appIconOutAdd" enabled="'+f[d].enabled+'"  appAddid="'+f[d].id+'" name="'+f[d].name+'" img="'+e+'" >';g+='<div addAppId="'+f[d].id+'" class="appIconAdd extEnabled'+(f[d].enabled?"true":"false")+'" style="background-image:url('+e+');">'+'</div><div class="appNameAdd">'+f[d].name+"</div>";if(checkappAdd(f[d].id)){g+='<img class="checkAdd" style="top:0px;left:0px;" src="img/checkAdd.png">'}else{g+='<img class="checkAdd" style="display:none;top:0px;left:0px;" src="img/checkAdd.png">'}g+="</div>"}}$("#addRightTop").html(g)})},loadMore:function(){$("#addRightOut").scroll(function(){var b=$(this)[0].scrollHeight;var d=$(this)[0].scrollTop;var c=$(this).height();if((d+c+10>=b)&&(b-c>11)){$infinityIcon.showRestIcons()}})}};$Add.ini();$infinityIcon.ini();$addIcon.ini()});